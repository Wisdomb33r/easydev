<?php
/*********************************************************************************
 * Autogenerated script
 * EasyDev v.0.x copyright Patrick Mingard 2007
 * Any modification of this code can alter the behaviour of EasyDev v.0.x console
 ********************************************************************************/

require_once('includes.php'); // includes of the generated script
 
// first set a variable to indicate to which "mainmenu" this script belongs to in the administration console.
$adminMainMenu = <% echo $mainmenuid; %>;
 
// verify that the logged user has right to see this page
if(! $session_permissions[$adminMainMenu]){ // the user should not see this page because he do not has rights
  header('Location: main.php');
  exit;
}

if($_SERVER[REQUEST_METHOD] == 'POST'){// if server method request == POST
  // delete all the ids the user checked in the object list
  foreach($_POST['deleteids'] as $deleteid){
    $query = 'DELETE FROM object_<% echo $this->name; %> WHERE id="'.$deleteid.'"';
    mysql_query($query) or die('Error while deleting object.<br />'.$query);
  }
  
  // make a redirection on the same page
   header('Location: '.$_SERVER['PHP_SELF'].'?'.CURRENTMENU.'='.$_GET[CURRENTMENU].'&action=confirmdelete');
  exit;
}
else{ // if the request_method == GET
  // includes the header of the page
  include 'adminheader.php';
  
  // if $_GET['action'] is set and is equal to "confirmdelete", print a message
  if(isset($_GET['action']) && $_GET['action'] == 'confirmDelete'){
    echo '<p><strong>'.htmlentities($translator->translate('generator_confirm_delete')).'</strong></p>';
  }

  if(isset($_GET['action']) && $_GET['action'] == 'confirmmodify'){
    echo '<p><strong>'.$translator->translate('generator_confirm_modify').'</strong></p>';
  }
  
  // print all the objects that are in the database and print a checkbox to choose to delete it
?>
<form action="<?php echo $_SERVER['PHP_SELF'].'?'.CURRENTMENU.'='.$_GET[CURRENTMENU]; ?>" method="post">
<table class="form deletescript">
  <tr valign="top">
    <td></td>
<?php
<%
foreach($this->fieldlist as $field){
  switch($field->type){
  case 'string':
  case 'integer':
  case 'double':
  case 'date':
  case 'image':
  case 'datetime':%>
  echo '    <td><% echo $field->label; %></td>'."\n";<%
  }
}
%>
?>
  </tr>
<?php
  $query = 'SELECT * FROM object_<% echo $this->name; %> ORDER BY id DESC';
  $result = mysql_query($query) or die('Error while selecting objects list.<br />'.$query);
  
  while($line = mysql_fetch_array($result)){
?>
  <tr valign="top">
    <td><input class="checkboxinput" type="checkbox" name="deleteids[]" value="<?php echo $line['id']; ?>" /><?php echo $line['id']; ?></td>
<?php
<%
$foundone = false;
foreach($this->fieldlist as $field){
  switch($field->type){
  case 'string':
  case 'integer':
  case 'date':
  case 'datetime':
  case 'double':%>
echo '<td>'.htmlentities($line['<% echo $field->label; %>']).'</td>';<%
    break;
  case 'image':%>
echo '    <td><img src="object_image_<% echo $this->name;%>_<% echo $field->label;%>.php?id='.$line['id'].'" width="50" height="50" /></td>';<%
    break;
  case 'relationNM':
  case 'relation1N':
  case 'bool':
    break;
  }
}
%>
?>
    <td><a class="default" href="objectadd_<% echo $this->name; %>.php?<?php echo CURRENTMENU.'='.$_GET[CURRENTMENU]; ?>&objectid=<?php echo $line['id']; ?>"><?php echo htmlentities($translator->translate('modify')); ?></a></td>
  </tr>
<?php
  }
?>
  <tr>
    <td></td>
    <td><input class="bouton" type="submit" name="delete<% echo $this->name; %>submit" value="<?php echo htmlentities($translator->translate('delete')); ?>" /></td>
    <td></td>
  </tr>
</table>
</form>
<?php
  // include the footer of the page
  include 'adminfooter.php';
}
?>

